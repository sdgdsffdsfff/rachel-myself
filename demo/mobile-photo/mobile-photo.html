<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta http-equiv="content-type" content="text/html;charset='utf-8'">
    <!--对于不同设备，它的分辨率和尺寸不同，所以需要设置viewport-->
    <meta name='viewport' content='width=device-width,initial-scale=1.0'>
    <link href="animate.css" rel='stylesheet' type="text/css">
    <script src='zpeto.js'></script>
    <style type="text/css">
        blockquote,body,button,dd,dl,dt, fieldset,form,h1,h2,h3,h4,
        legend,li,ol,p,pre,td,textarea,th,ul,img {
            margin: 0;
            padding: 0;
        }
        body {
            background-color: black;
        }
        ul {
            list-style: none;
        }
        li {
            width: 100px;/*js动态计算*/
            height: 100px;
            overflow: hidden;
            float: left;
            border: 1px solid red;
        }
        .large {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background-color: black;
        }
    </style>
</head>
<body>
    <ul id='container' class="img-container">
    </ul>
    <div class="large animated fadeIn" id='large-container' style="display: none;">
        <img id='large-img' />
    </div>
    <!--html5可以不用写type＝‘text/javascript’-->
    <script>
        var total = 11;
        var zWin = $(window);
        var render = function() {
            var padding = 2;
            var winWidth = zWin.width();
            var picWidth = Math.floor((winWidth - padding * 3 - 8) / 4);
            var tmpl = '';
            for (var i = 1; i <= total; i++) {
                var p = padding;
                var imgSrc = 'img/' + i + '.jpg';
                if (i % 4 == 1) {
                    p = 0;
                }
//                tmpl += '<li style="width: ' + picWidth + 'px;height: ' + picWidth + 'px;padding-top: ' + padding + 'px; padding-left: ' + p + 'px"><img src="' + imgSrc + '"></li>';
                tmpl += '<li data-id="' + i + '" class="animated bounceIn" style="width: ' + picWidth + 'px;height: ' + picWidth + 'px;padding-top: ' + padding + 'px; padding-left: ' + p + 'px"><canvas id="cvs_' + i + '"></canvas></li>';
                var imageObj = new Image();
                imageObj.index = i;//标识
                imageObj.onload = function() {
                    var cvs = $('#cvs_' + this.index)[0].getContext('2d');
                    cvs.width = this.width;
                    cvs.height = this.height;
                    cvs.drawImage(this, 0, 0);
                }
                imageObj.src = imgSrc;
            }
            $('#container').html(tmpl);
        }
        render();

        var wImage = $('#large-img');
        var loadImg = function(id, callback) {
            $('#large-container').css({
                width: zWin.width(),
                height: zWin.height()
            }).show();
            var imgsrc = 'img/' + id + '.large.jpg';
            var imageObj = new Image();
            imageObj.onload = function() {
                var w = this.width;
                var h = this.height;
                var winWidth = zWin.width();
                var winHeight = zWin.height();
                var realW = winHeight * w / h;
                var paddingLeft = parseInt((winWidth - realW) / 2);
                var realH = winWidth * h / w;
                var paddingTop = parseInt((winHeight - realH) / 2);
                wImage.css({
                    'width': 'auto',
                    'height': 'auto',
                    'padding-left': '0px',
                    'padding-top': '0px'
                })
                //竖图
                if (h / w > 1.2) {
                    wImage.attr('src', imgsrc).css({
                        'height': winHeight,
                        'padding-left': paddingLeft
                    });
                } else {
                    wImage.attr('src', imgsrc).css({
                        'width': winWidth,
                        'padding-top': paddingTop
                    });
                }
                //加载完后动画
                callback && calback();
            };
            imageObj.src = imgsrc;
        }

        var cid;
        //事件代理
        $('#container').delegate('li', 'tap', function() {
            var _id = $(this).attr('data-id');
            loadImg(_id);
        });

        $('#large-container').tap(function() {
            $(this).hide();
        });

        $('#large-container').swipeLeft(function() {
            cid++;
            if (cid > total) {
                cid = total;
            } else {
                wImage[0].addEventListener('webkitAnimationEnd', function() {
                    wImage.removeClass('animated bounceInRight');
                    wImage[0].removeEventListener('webkitAnimationEnd');
                }, false);
                loadImg(cid, function() {
                    wImage.addClass('animated bounceInRight');
                });
            }
        });

        $('#large-container').swipeRight(function() {
            cid--;
            if (cid < 1) {
                cid = 1;
            } else {
                loadImg(cid, function() {
                    wImage[0].addEventListener('webkitAnimationEnd', function() {
                        wImage.removeClass('animated bounceInLeft');
                        wImage[0].removeEventListener('webkitAnimationEnd');
                    }, false);
                    wImage.addClass('animated bounceInLeft');
                });
            }
        });
    </script>
</body>
</html>













