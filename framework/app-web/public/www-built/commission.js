define("ui.autocomplete",["zepto","zepto.sp","zepto.temp"],function(e,t,n){var r=function(t){var n=this;n.op=e.extend({},{inputSelect:"#auto_ipt",resources:[],listSelect:"#auto_content",liSelect:"div.item",boxSelect:null,liTpl:"autocomplete_tpl"},t),n.dom=e(n.op.inputSelect),n.list=e(n.op.listSelect),n.contentBox=n.op.boxSelect==null?n.list:e(n.op.boxSelect),n.cancelBtn=e("#btn_cancel"),n.cancelAll=e("#cancel_all"),n.init()};return r.prototype.init=function(){var n=this;n.list.on("tap",n.op.liSelect,function(r){e(n.dom).val(e(this).data("name")),t.publish("value_changed",[{name:e(this).data("name"),cityid:e(this).data("cityid"),id:e(this).data("id")}]),n.close()}),n.dom.on("input",function(e){n.getResult()}),n.cancelBtn.on("tap",function(e){e.preventDefault(),n.list.hide(),t.publish("search_canceled",[])}),n.cancelAll.on("tap",function(e){e.preventDefault(),n.cancelSearch()})},r.prototype.getResult=function(){var t=this,n=e.trim(t.dom.val());if(!n){t.cancelAll.hide(),t.list.hide();return}t.cancelAll.show();if(e.isArray(t.op.resources)){var r=t.op.resources;t.dataHandle(r)}else typeof t.op.resources=="string"?e.ajax({type:"post",url:t.op.resources,data:t.op.reqDataInit(n),dataType:"json",success:function(e){var n=t.op.repDataInit(e);t.dataHandle(n)}}):t.op.resources({data:{keyword:n},sucFn:function(e){t.dataHandle(e)},errFn:function(){}})},r.prototype.dataHandle=function(e){var t=this;t.da=e,t.contentBox.html(n(t.op.liTpl,{names:e})),t.open()},r.prototype.close=function(){this.contentBox.empty().hide()},r.prototype.open=function(){this.contentBox.show()},r.prototype.cancelSearch=function(){var e=this;e.dom.val(""),e.cancelAll.hide(),e.list.hide()},r}),define("app/service/commissionService",["zepto","ajax"],function(e,t){function n(e){var n=e.data;t({type:"GET",url:"/api/community",data:{keyword:n.keyword},dataType:"json",success:e.sucFn,error:e.errFn})}function r(e){var n=e.data;t({type:"POST",url:"/api/commission/publish",data:n,dataType:"json",success:e.sucFn,error:e.errFn})}return{getCommunityList:n,saveCommission:r}}),define("app/commission",["zepto","zepto.temp","ui.autocomplete","zepto.sp","app/service/commissionService"],function(e,t,n,r,i){var s=function(t){var r=this;r._op=e.extend({},{resources:[]},t),r.auto=new n({resources:r._op.resources}),r.$searchIpt=e("#search_input"),r.$entrustWrap=e("#entrust_wrap"),r.$autoIpt=e("#auto_ipt"),r.$autoCont=e("#auto_content"),r.$cancelAll=e("#cancel_all"),r.$btnEntrust=e("#btn_entrust"),r.$room=e(".room"),r.$hall=e(".hall"),r.$sale=e(".sale"),r.$tele=e(".tele"),r.$msg=e(".error-msg"),r.$id=e("#hidden_id"),r.$cityid=e("#hidden_cityid"),r.init()};s.prototype={init:function(){var t=this;r.subscribe("value_changed",function(e){t.$entrustWrap.next().hide(),t.$entrustWrap.show(),t.$searchIpt.val(e.name),t.$id.val(e.id),t.$cityid.val(e.cityid)}),r.subscribe("search_canceled",function(e){t.$entrustWrap.next().hide(),t.$entrustWrap.show()}),r.subscribe("error",function(e){t.$msg.empty().text(s._default[e]).addClass("show")}),r.subscribe("success",function(){t.$msg.empty().removeClass("show");var n={city_id:t.$cityid.val(),community_id:t.$id.val(),community_name:t.$searchIpt.val(),bedrooms:e("#room").val(),living_rooms:e("#hall").val(),price:e("#price").val(),phone:e("#phone").val()};t.$searchIpt.data("userid")&&(n.user_id=t.$searchIpt.data("userid")),i.saveCommission({data:n,sucFn:function(e){window.location.href=e.redirect},error:function(e){t.$msg.empty().text(e.msg).addClass("show")}})}),t.$searchIpt.focus(function(e){e.preventDefault(),t.$entrustWrap.hide().next().show(),t.$autoIpt.val(t.$searchIpt.val()),t.$autoIpt.val()?(t.$cancelAll.show(),t.auto.getResult()):(t.$cancelAll.hide(),t.$autoCont.hide()),t.$autoIpt.focus()}),t.$btnEntrust.on("tap",function(e){t.validate()})},validate:function(){var e=this,t=s._rulesText;if(!t.areaName(e.$searchIpt.val())){r.publish("error",["name"]);return}if(!t.room(e.$room.val())){r.publish("error",["room"]);return}if(!t.hall(e.$hall.val())){r.publish("error",["hall"]);return}if(!t.sale(e.$sale.val())){r.publish("error",["sale"]);return}if(!t.tele(e.$tele.val())){r.publish("error",["tele"]);return}r.publish("success")}},s._rulesText={areaName:function(e){return!!e},room:function(e){return e>0&&e<10},hall:function(e){return e<=9},sale:function(e){return e!==""&&e<=4e5},tele:function(e){return/^1\d{10}$/.test(e)}},s._default={name:"请填写小区名字",room:"室必须是1~9之间的整数",hall:"厅必须是0~9之间的整数",sale:"售价必须是40亿及以下的数值",tele:"手机格式不正确"},new s({resources:i.getCommunityList})}),require(["./common"],function(e){require(["app/commission","ui.autocomplete"])}),define("../commission",function(){});