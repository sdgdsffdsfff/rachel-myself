define("ui.popup",["zepto"],function(e){function s(s){function o(){var r='<div style="padding; 0; margin: 0;" class="'+t.containerName+'"></div>';n=e(r)}function u(i,s){var o="z-index: 10000; width:"+i+"px; height: "+e("html").height()+"px;position: absolute; left: 0; top: 0;background-color:"+t.maskColor+"; opacity: "+t.maskOpacity+";",u='<div style="'+o+'" class="'+t.maskName+'"></div>';r=e(u),r.appendTo(n)}function a(r,s){var o="background: #fff;position: absolute; z-index: 100001; width: "+t.width+"px; height: "+t.height+"px;",u='<div class="'+t.contentName+'" style="'+o+'">'+t.content+"</div>";i=e(u),i.appendTo(n)}function f(n,r){var s={},o=t.position;o.left?s.left=o.left+"px":o.right?s.right=o.right+"px":s.left=(n-t.width)/2+"px",o.top?s.top=o.top+"px":o.bottom?s.bottom=o.bottom+"px":s.top=(r-t.height)/2+e(window).scrollTop()+"px",i.css(s)}function l(){n.hide()}function c(){n.show(),t.showTime>0&&setTimeout(function(){l()},t.showTime)}function h(e){i.html(e),t.isResetPos&&f((new v).width(),(new v).height())}function p(){setTimeout(function(){l()},t.showTime)}function d(){e(window).on("resize",function(){var e=(new v).width(),n=(new v).height();f(e,n),t.isMask&&r.css({width:e+"px",height:n+"px"})}),e(window).on("scroll",function(e){})}function v(){function r(){return n.clientHeight}function i(){return n.clientWidth}var e=window,t=document,n=t.documentElement;return{height:r,width:i}}function m(e){t.height=e}return function(){t=e.extend(t,s),o();var r=(new v).width(),i=(new v).height();t.isMask&&u(r,i),a(r,i),n.appendTo(e(document.body)),f(r,i),t.showTime&&p(),d()}(),{closePop:l,showPop:c,changeContent:h,setShowTime:p,setPosition:f,changePopHeight:m}}var t={isMask:!0,maskColor:"#333",maskOpacity:"0.4",content:"",width:200,height:200,position:{},isResetPos:!0,maskName:"pop-mask",contentName:"pop-content",containerName:"pop-container",showTime:0},n,r,i;return s}),define("userService",["zepto","ajax"],function(e,t){function n(e){var n=e.data;t({type:"POST",url:"/api/schedules/"+n.scheid+"/review",data:{level:n.level,content:n.content},dataType:"json",success:e.sucFn,error:e.errFn})}function r(e){var n=e.data;t({type:"PUT",url:"/api/inventories/"+n.property_id+"/wishlist/add",data:{url:window.location.href},dataType:"json",success:e.sucFn,error:e.errFn})}function i(e){var n=e.data;t({type:"PUT",url:"/api/inventories/"+n.property_id+"/wishlist/remove",dataType:"json",success:e.sucFn,error:e.errFn})}function s(e){var n=e.data;t({type:"PUT",url:"/api/schedules/"+n.id+"/complete",dataType:"json",success:e.sucFn,error:e.errFn})}function o(e){var n=e.data;t({type:"PUT",url:"/api/schedules/"+n.id+"/cancel",data:{reason_type:n.reason_type},dataType:"json",success:e.sucFn,error:e.errFn})}function u(e){t({type:"GET",url:"/api/property",data:e.pageInfo,dataType:"json",success:e.sucFn})}return{vote:n,addFavorite:r,cancelFavorite:i,cancelSchedule:o,completeSchedule:s,getMoreProperty:u}}),define("app/schedule",["zepto","zepto.temp","zepto.sp","ui.popup","userService","module"],function(e,t,n,r,i,s){var o=function(t){var n=this;n._op=e.extend({},{noshowTpl:"",confirmTpl:"",scheduleCount:s.config().scheduleCount},t),n._op.scheduleCount>0&&e("body,html,.page").height("auto"),n.showDialog=new r({width:"300",height:"auto"}),n.showDialog.closePop(),n.data={},n.init()};o.prototype.init=function(){var t=this;e(".no-show").on("tap",function(n){n.preventDefault();var r=n.target,i=e(r).closest(".schedule-box").data("id");t.bindTouch(),t.showDialog.changePopHeight("222"),t.showDialog.changeContent(t._op.confirmTpl),t.showDialog.showPop(),e("body").addClass("overflow"),t.data.id=i}),e(".confirm-show").on("tap",function(n){n.preventDefault();var r=n.target,i=e(r).closest(".schedule-box").data("id");t.bindTouch(),t.showDialog.changePopHeight("136"),t.showDialog.changeContent(t._op.noshowTpl),t.showDialog.showPop(),e("body").addClass("overflow"),t.data.id=i}),e(".pop-container").on("tap",["#no_cancel","#no_submit","#show_cancel","#show_submit",'input[type="radio"]'],function(n){n.preventDefault();var r=e(n.target);if(r.is("#no_cancel")||r.is("#show_cancel"))e("body").removeClass("overflow"),t.offTouch(),t.showDialog.closePop();else if(r.is("#no_submit")){var s=e(".noshow-dialog").find("input:checked");s.length>0?(t.data.reason_type=s.data("reasonid"),i.cancelSchedule({data:{id:t.data.id,reason_type:t.data.reason_type},sucFn:function(e){t.showDialog.closePop(),window.location.href="/schedules/"+t.data.id}})):e(".error-msg").empty().html("请选择原因")}else r.is("#show_submit")?(t.data.reason_type="",i.completeSchedule({data:{id:t.data.id},sucFn:function(e){t.showDialog.closePop(),window.location.href="/schedules/"+t.data.id}})):r.closest("label")&&e(".error-msg").empty().html("&nbsp;")})},o.prototype.bindTouch=function(){e("body").on("touchmove",function(e){e.preventDefault()})},o.prototype.offTouch=function(){e("body").off("touchmove")},new o({noshowTpl:e("#noshow_tpl").html(),confirmTpl:e("#confirm_tpl").html()})}),require(["./common"],function(e){require(["app/schedule"])}),define("../schedule",function(){});