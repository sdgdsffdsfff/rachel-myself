define("ui.vote",["zepto","zepto.sp"],function(e,t){(function(e){var t={nextAll:function(t){var n=e(),r=this.next();while(r.length){if(typeof t=="undefined"||r.is(t))n=n.add(r);r=r.next()}return n},prevAll:function(t){var n=e(),r=this.prev();while(r.length){if(typeof t=="undefined"||r.is(t))n=n.add(r);r=r.prev()}return n}};e.extend(e.fn,t)})(Zepto);var n=function(t){var n=this;n._op=e.extend({},{commitVote:null},t),n.$voteBox=e("#vote-box"),n.$star=n.$voteBox.find(".star"),n.$item=n.$star.find("i"),n.$btn=n.$voteBox.find(".btn-commit"),n.$ipt=n.$voteBox.find('textarea[name="vote"]'),n.count=0,n.init()};return n.prototype.init=function(){var n=this;n.$star.on("click","i",function(t){var r=e(t.target);if(r.is(".edit"))return;var i=n.$item.index(e(this));n.count=e(this).data("count"),e(this).prevAll().addClass("selected"),e(this).addClass("selected"),e(this).nextAll().removeClass("selected")}),n.$btn.on("click",function(r){if(!n.count){e(".error").text("请选择服务评价");return}e(".error").text(""),e(this).addClass("com-btn-dis"),n.$star.find("i").addClass("edit"),t.publish("vote_committed",[{scheid:n.$btn.data("scheid"),level:n.count,content:n.$ipt.val()}])}),t.subscribe("vote_commit_succeed",function(t){n.$btn.hide(),n.$ipt.hide(),e(".vote-msg").removeClass("hidden").empty().html(t.content)}),t.subscribe("vote_commit_error",function(e){})},n}),define("userService",["zepto","ajax"],function(e,t){function n(e){var n=e.data;t({type:"POST",url:"/api/schedules/"+n.scheid+"/review",data:{level:n.level,content:n.content},dataType:"json",success:e.sucFn,error:e.errFn})}function r(e){var n=e.data;t({type:"PUT",url:"/api/inventories/"+n.property_id+"/wishlist/add",data:{url:window.location.href},dataType:"json",success:e.sucFn,error:e.errFn})}function i(e){var n=e.data;t({type:"PUT",url:"/api/inventories/"+n.property_id+"/wishlist/remove",dataType:"json",success:e.sucFn,error:e.errFn})}function s(e){var n=e.data;t({type:"PUT",url:"/api/schedules/"+n.id+"/complete",dataType:"json",success:e.sucFn,error:e.errFn})}function o(e){var n=e.data;t({type:"PUT",url:"/api/schedules/"+n.id+"/cancel",data:{reason_type:n.reason_type},dataType:"json",success:e.sucFn,error:e.errFn})}function u(e){t({type:"GET",url:"/api/property",data:e.pageInfo,dataType:"json",success:e.sucFn})}return{vote:n,addFavorite:r,cancelFavorite:i,cancelSchedule:o,completeSchedule:s,getMoreProperty:u}}),define("ui.popup",["zepto"],function(e){function s(s){function o(){var r='<div style="padding; 0; margin: 0;" class="'+t.containerName+'"></div>';n=e(r)}function u(i,s){var o="z-index: 10000; width:"+i+"px; height: "+e("html").height()+"px;position: absolute; left: 0; top: 0;background-color:"+t.maskColor+"; opacity: "+t.maskOpacity+";",u='<div style="'+o+'" class="'+t.maskName+'"></div>';r=e(u),r.appendTo(n)}function a(r,s){var o="background: #fff;position: absolute; z-index: 100001; width: "+t.width+"px; height: "+t.height+"px;",u='<div class="'+t.contentName+'" style="'+o+'">'+t.content+"</div>";i=e(u),i.appendTo(n)}function f(n,r){var s={},o=t.position;o.left?s.left=o.left+"px":o.right?s.right=o.right+"px":s.left=(n-t.width)/2+"px",o.top?s.top=o.top+"px":o.bottom?s.bottom=o.bottom+"px":s.top=(r-t.height)/2+e(window).scrollTop()+"px",i.css(s)}function l(){n.hide()}function c(){n.show(),t.showTime>0&&setTimeout(function(){l()},t.showTime)}function h(e){i.html(e),t.isResetPos&&f((new v).width(),(new v).height())}function p(){setTimeout(function(){l()},t.showTime)}function d(){e(window).on("resize",function(){var e=(new v).width(),n=(new v).height();f(e,n),t.isMask&&r.css({width:e+"px",height:n+"px"})}),e(window).on("scroll",function(e){})}function v(){function r(){return n.clientHeight}function i(){return n.clientWidth}var e=window,t=document,n=t.documentElement;return{height:r,width:i}}function m(e){t.height=e}return function(){t=e.extend(t,s),o();var r=(new v).width(),i=(new v).height();t.isMask&&u(r,i),a(r,i),n.appendTo(e(document.body)),f(r,i),t.showTime&&p(),d()}(),{closePop:l,showPop:c,changeContent:h,setShowTime:p,setPosition:f,changePopHeight:m}}var t={isMask:!0,maskColor:"#333",maskOpacity:"0.4",content:"",width:200,height:200,position:{},isResetPos:!0,maskName:"pop-mask",contentName:"pop-content",containerName:"pop-container",showTime:0},n,r,i;return s}),define("app/schedule-detail",["zepto","zepto.temp","ui.vote","zepto.sp","userService","ui.popup"],function(e,t,n,r,i,s){var o=function(){var t=this;t.pop=new s({showTime:1e3,width:"135",height:"135",content:e("#vote-popup").html()}),t.pop.closePop(),t.v=new n,t.init()};o.prototype={init:function(){var t=this;r.subscribe("vote_committed",function(e){i.vote({data:e,sucFn:function(n){t.pop.showPop(),r.publish("vote_commit_succeed",[e])},errFn:function(e){t.pop.closePop(),r.publish("vote_commit_error",[e])}})}),e(".house-wrap").on("tap",[".add-favorite",".cancel-favorite"],function(n){n.preventDefault();var r=n.target,s=e(r).closest("a");if(s.is(".add-favorite")||s.is(".cancel-favorite")){var o=s.data("id"),u=s.data("isfavorite");u==0?i.addFavorite({data:{property_id:o},sucFn:function(e){t.handleFavorite(e,u,s)},errFn:function(e){e.redirect&&(window.location.href=e.redirect)}}):i.cancelFavorite({data:{property_id:o},sucFn:function(e){t.handleFavorite(e,u,s)},errFn:function(e){e.redirect&&(window.location.href=e.redirect)}})}})},handleFavorite:function(e,t,n){e&&e.call_back?window.location.href=e.call_back:t==0?(n.empty().html('<i class="iconfont">&#xe615;</i>').data("isfavorite",1),n.removeClass("add-favorite"),n.addClass("cancel-favorite")):(n.empty().html("想买").data("isfavorite",0),n.removeClass("cancel-favorite"),n.addClass("add-favorite"))}},new o}),require(["./common"],function(e){require(["app/schedule-detail"])}),define("../comment",function(){});