<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content='text/html; charset=utf-8' />
    <!--为了不让它默认的放大等行为，规定用户无法缩放-->
    <meta name='viewpoint' content="width=device-width, initial-scale=1.0, maximun-scale=1.0, minimum-scale=1.0, user-scalable=no" />
    <!--针对苹果的优化，可选。是否可将苹果应用为全屏，类似于app-->
    <meta name='apple-touch-fullscreen' content='YES' />
    <!--苹果上有状态条，改变它的颜色为黑色-->
    <meta name='apple-mobile-web-app-status-bar-style' content='black' />
    <style>
        /*默认样式*/
        body {
            margin: 0;
            padding: 0;
            background: #333;
            overflow: hidden;
            height: 100%;
            /*当给一个元素设置百分比时，它需要一个比照，如果没有父，则需要给一个定位值。但是在移动开发时，使用position，会很好性能。所以不建议这种方式。一般采用js计算*/
            position: absolute;
        }

        #canvas {
            height: 100%;
            /*当是百分比，是相对它的父元素。如果它的父元素没有对应height，则会出问题*/
            width: 100%;
            overflow: hidden;
        }

        ul, li {
            list-style: none;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }
        /*垂直居中*/
        /*li {*/
            /*display: table-cell;*/
            /*vertical-align: middle;*/
        /*}*/

        li {
            position: absolute;/*会造成内存耗用很大*/
            display: -webkit-box;
            -webkit-box-pack: center;
            -webkit-box-align: center;

            /*避免元素会在实际的手机当中闪烁*/
            -webkit-backface-visibility: hidden;
        }

        li img {
            max-width: 100%;
            max-height: 100%;
        }
    </style>
</head>
<body>
    <div id="canvas">
        <!--<ul>-->
            <!--&lt;!&ndash;此处我们不用浮动，用translate3d＋absolute。&ndash;&gt;-->
            <!--<li style="width: 568px; -webkit-translate3d(0, 0, 0);position: absolute;">-->
                <!--<img src='imgs/1.jpg' width='320'/>-->
            <!--</li>-->
            <!--<li style="width: 568px; -webkit-translate3d(320px, 0, 0);position: absolute;">-->
                <!--<img src='imgs/2.jpg' width='320'/>-->
            <!--</li>-->
            <!--<li style="width: 568px; -webkit-translate3d(640px, 0, 0);position: absolute;">-->
                <!--<img src='imgs/3.jpg' width='320'/>-->
            <!--</li>-->
        <!--</ul>-->
    </div>
    <script type="text/javascript">
        //所有数据
        var list = [{
            height: 340,
            src: 'imgs/1.jpg',
            width: 230
        },{
            height: 371,
            src: 'imgs/2.jpg',
            width: 230
        },{
            height: 345,
            src: 'imgs/3.jpg',
            width: 230
        },{
            height: 320,
            src: 'imgs/4.jpg',
            width: 210
        },{
            height: 300,
            src: 'imgs/5.jpg',
            width: 233
        },{
            height: 354,
            src: 'imgs/6.jpg',
            width: 528
        }];

        function Slider(opts) {
            this.wrap = opts.dom;
            this.list = opts.list;

            this.init();//初始化，做一些初始值的准备等
            this.renderDOM();
            this.bindDOM();
        }

        Slider.prototype.init = function() {
            //浏览器内部窗口高度。算出窗口的长宽比
            this.radio = window.innerHeight / window.innerWidth;
            this.scaleW = window.innerWidth;//设置滚动一屏的距离
            //当前图片的索引
            this.idx = 0;
        };

        //根据数据生成html
        Slider.prototype.renderDOM = function() {
            var wrap = this.wrap;
            var data = this.list;
            var len = data.length;
            var scale = this.scaleW;

            this.outer = document.createElement('ul');
            for (var i = 0; i < len; i++) {
                var li = document.createElement('li');
                var item = data[i];
                li.style.width = scale + 'px';
                li.style.webkitTransform = 'translate3d('+ i * scale + 'px, 0 ,0)';
                //判断是按照宽还是高做等比缩放
                if (item) {
                    if (item['height'] / item['width'] > this.radio) {
                        li.innerHTML = '<img height="'+ window.innerHeight +'" src="' + item['src'] + '">';
                    } else {
                        //扁平，上下有空隙
                        li.innerHTML = '<img width="'+ window.innerWidth +'" src="' + item['src'] + '">';

                    }
                }
                this.outer.appendChild(li);
            }
            this.outer.style.width = scale + 'px';
            wrap.style.height = window.innerHeight + 'px';//width:100%
            wrap.appendChild(this.outer);
        };

        Slider.prototype.bindDOM = function() {
            var self = this;
            var scale = self.scaleW;
            var outer = self.outer;
            var len = self.list.length;

            var startHandler = function(evt) {
                //记录开始的位移
                self.startX = evt.touches[0].pageX;//单点触摸
                self.offsetX = 0;
                self.startTime = new Date() * 1;
            };

            var moveHandler = function(evt) {
                evt.preventDefault();//阻止默认行为（浏览器的默认行为）
                self.offsetX = evt.touches[0].pageX - self.startX;

                //让图片跟随鼠标的移动而移动，改变translate3d的值
                //因为滑动最多能看到三张图片，所以只需要改变这三张图片的translate3d值即可
                var lis = outer.getElementsByTagName('li');
                var i = self.idx - 1;
                var m = self.idx + 1;
                for (i; i < m; i++) {
                    //移动的中间的那个值为0
                    lis[i] && (lis[i].style.webkitTransform = 'translate3d(' + ((i - self.idx) * scale + self.offsetX) + ',0,0)');
                    //防止滑动有延迟
                    lis[i] && (lis[i].style.webkitTransition = 'none');
                }
            };

            var endHandler = function(evt) {
                //判断是进入下一张还是上一张，还是当前页面
                var boundary = scale / 6;
                var endTime = new Date() * 1;
                var lis = self.outer.getElementsByTagName('li');

                if (self.endTime - self.startTime > 800) {
                    //满操作
                    if (self.offsetX == boundary) {
                        //进入上一页面
                        self.go('-1');

                    } else if (self.offsetX < -boundary) {
                        //进入下一页面
                        self.go('+1');

                    } else {
                        //偏移不够大，留在本页面
                        self.go('0');
                    }
                } else {
                    //快操作，优化：这样是可以直接进入下一页面，使得更流畅
                    if (self.offsetX > 50) {
                        self.go('-1');
                    } else if (self.offsetX < -50) {
                        self.go('+1');
                    } else {
                        self.go('0');
                    }
                }

            };

            //slider.go(2);表示直接去到第二页
            Slider.prototype.go = function(n) {
                var idx = self.idx;//表示当前index
                var cidx;//表示下一个index
                var lis = self.outer.getElementsByTagName('li');
                var len = lis.length;
                var scale = self.scaleW;

                if (typeof n == 'number') {
                    cidx = idx;
                } else if (typeof n == 'string') {
                    cidx = idx + n * 1;
                }
                //当索引从右边超出
                if (cidx > len - 1) {
                    cidx = len - 1;
                } else if (cidx < 0) {
                    cidx = 0;
                }
                this.idx = cidx;

                //给做动画的设置
                //过度属性值的名称（因为下面是使用Transform，第二个是时间），
                lis[cidx].style.webkitTransition = '-webkitTransform 0.2s ease-out';
                lis[cidx - 1] && (lis[cidx - 1].style.webkitTransition = '-webkitTransform 0.2s ease-out');
                lis[cidx + 1] && (lis[cidx + 1].style.webkitTransition = '-webkitTransform 0.2s ease-out');


                lis[cidx].style.webkitTransform = 'translate3d(0, 0, 0)';
                lis[cidx - 1] && (lis[cidx - 1].style.webkitTransform = 'translate3d(-' + scale + 'px, 0, 0)');
                lis[cidx + 1] && (lis[cidx + 1].style.webkitTransform = 'translate3d(' + scale + 'px, 0, 0)');


            };

            self.outer.addEventListener('touchstart', startHandler);
            self.outer.addEventListener('touchmove', moveHandler);
            self.outer.addEventListener('touchend', endHandler);
        }

        new Slider({
           'dom': document.getElementById('canvas'),
            'list': list
        });
    </script>
</body>
</html>